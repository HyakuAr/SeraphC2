# SeraphC2 HTTPS Setup Guide

SeraphC2 currently only supports HTTP natively. To enable HTTPS, you need to set up a reverse proxy using nginx or Apache. This guide shows how to set up nginx as a reverse proxy for HTTPS.

## Why HTTPS is Not Built-in

SeraphC2 focuses on C2 functionality and delegates SSL/TLS termination to proven web servers like nginx or Apache. This approach provides:

- Better performance and security
- More flexible SSL configuration options
- Easier certificate management
- Industry-standard SSL implementations

## Prerequisites

- SeraphC2 installed and running on HTTP port (default: 3000)
- SSL certificates generated by the setup script (located in `/etc/seraphc2/ssl/`)
- Root or sudo access to install and configure nginx

## Step 1: Install Nginx

### Ubuntu/Debian:
```bash
sudo apt update
sudo apt install nginx
```

### CentOS/RHEL/Fedora:
```bash
sudo yum install nginx  # CentOS/RHEL 7
sudo dnf install nginx  # CentOS/RHEL 8+ / Fedora
```

## Step 2: Configure Nginx

1. Copy the example configuration:
```bash
sudo cp nginx-https-example.conf /etc/nginx/sites-available/seraphc2
```

2. Edit the configuration file:
```bash
sudo nano /etc/nginx/sites-available/seraphc2
```

3. Update the following settings:
   - Change `server_name localhost;` to your domain name
   - Verify SSL certificate paths match your installation
   - Adjust ports if you changed defaults during installation

## Step 3: Enable the Configuration

### Ubuntu/Debian:
```bash
sudo ln -s /etc/nginx/sites-available/seraphc2 /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default  # Remove default site
```

### CentOS/RHEL/Fedora:
```bash
# Add include directive to /etc/nginx/nginx.conf if not present
echo "include /etc/nginx/sites-enabled/*;" | sudo tee -a /etc/nginx/nginx.conf
sudo mkdir -p /etc/nginx/sites-enabled
sudo ln -s /etc/nginx/sites-available/seraphc2 /etc/nginx/sites-enabled/
```

## Step 4: Test and Start Nginx

1. Test the configuration:
```bash
sudo nginx -t
```

2. If the test passes, start/restart nginx:
```bash
sudo systemctl restart nginx
sudo systemctl enable nginx
```

## Step 5: Update Firewall

If you have a firewall enabled, allow HTTPS traffic:

### UFW (Ubuntu):
```bash
sudo ufw allow 'Nginx Full'
```

### Firewalld (CentOS/RHEL/Fedora):
```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

## Step 6: Test HTTPS Access

1. Open your browser and navigate to:
   - `https://your-domain:8443` (or your configured HTTPS port)
   - `https://localhost:8443` (if using localhost)

2. You may see a security warning for self-signed certificates - this is normal
3. Click "Advanced" and "Proceed to localhost" (or your domain)

## Using Let's Encrypt (Production)

For production environments, replace self-signed certificates with Let's Encrypt:

1. Install certbot:
```bash
sudo apt install certbot python3-certbot-nginx  # Ubuntu/Debian
sudo yum install certbot python3-certbot-nginx  # CentOS/RHEL
```

2. Obtain certificate:
```bash
sudo certbot --nginx -d your-domain.com
```

3. Certbot will automatically update your nginx configuration

## Troubleshooting

### Common Issues:

1. **502 Bad Gateway**: SeraphC2 is not running or not accessible
   - Check: `sudo systemctl status seraphc2`
   - Check: `curl http://localhost:3000`

2. **SSL Certificate Errors**: Certificate path or permissions issues
   - Verify: `sudo ls -la /etc/seraphc2/ssl/`
   - Check: `sudo nginx -t`

3. **Port Already in Use**: Another service is using port 8443
   - Check: `sudo netstat -tlnp | grep 8443`
   - Change port in nginx configuration if needed

4. **Permission Denied**: Nginx can't read SSL certificates
   - Fix permissions: `sudo chmod 644 /etc/seraphc2/ssl/server.crt`
   - Fix permissions: `sudo chmod 600 /etc/seraphc2/ssl/server.key`

### Logs to Check:

- Nginx error log: `/var/log/nginx/error.log`
- Nginx access log: `/var/log/nginx/access.log`
- SeraphC2 logs: `sudo journalctl -u seraphc2 -f`

## Security Considerations

1. **Certificate Validation**: Self-signed certificates provide encryption but not identity verification
2. **Regular Updates**: Keep nginx and certificates updated
3. **Strong Ciphers**: The example configuration uses modern, secure cipher suites
4. **HSTS**: Strict-Transport-Security header is enabled to prevent downgrade attacks

## Alternative: Apache Configuration

If you prefer Apache over nginx, here's a basic configuration:

```apache
<VirtualHost *:8443>
    ServerName localhost
    
    SSLEngine on
    SSLCertificateFile /etc/seraphc2/ssl/server.crt
    SSLCertificateKeyFile /etc/seraphc2/ssl/server.key
    
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/
    
    # WebSocket support
    ProxyPass /socket.io/ ws://127.0.0.1:3000/socket.io/
    ProxyPassReverse /socket.io/ ws://127.0.0.1:3000/socket.io/
</VirtualHost>
```

Enable required modules:
```bash
sudo a2enmod ssl proxy proxy_http proxy_wstunnel
```

## Support

If you encounter issues with HTTPS setup:

1. Check the SeraphC2 logs for any application errors
2. Verify nginx configuration with `sudo nginx -t`
3. Test HTTP access first to ensure SeraphC2 is working
4. Check firewall and port accessibility
5. Review nginx error logs for specific SSL/proxy errors